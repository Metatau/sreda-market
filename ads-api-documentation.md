# ADS-API.RU - Документация API

## Введение

API позволяет получать объявления из базы данных ADS-API.RU, которая собирает данные с различных площадок:
- avito.ru
- realty.yandex.ru  
- cian.ru
- sob.ru
- youla.ru
- moyareklama.ru
- domclick.ru

**Базовый URL**: `https://ads-api.ru/main/api`

## Ограничения и особенности

### Общие ограничения
- **Пауза между запросами**: минимум 5 секунд для одного пользователя
- **Кодирование параметров**: обязательно для спецсимволов и пробелов
- **Неполная выборка**: система не собирает 100% объявлений, но пропуски незначительны

### Тестовый доступ
- Выдается один раз на 14 дней
- Номера телефонов частично скрыты (XXXXX)
- Поле `price` всегда равно 0
- Максимум 50 объявлений за запрос
- Параметр `phone` запрещен

### Платный доступ
- Максимум 1000 объявлений за запрос
- Полные номера телефонов
- Реальные цены
- Все параметры доступны

## Коды ответов

| Код | Описание |
|-----|----------|
| 200 | Успешно |
| 400 | Ошибка запроса (неизвестные параметры) |
| 401 | Неверные user или token |
| 402 | Срок действия token истек |
| 403 | Учетная запись заблокирована |
| 404 | Объявление не найдено |
| 429 | Превышен лимит частоты запросов |
| 452 | Доступ только из программы партнера |
| 453 | Доступ только к категории "Недвижимость" |
| 454 | Доступ только к определенному городу |
| 455 | Метод доступен только для платного тарифа |

## Методы API

### 1. Получение объявлений (`/main/api`)

**URL**: `https://ads-api.ru/main/api`  
**Метод**: GET

#### Обязательные параметры
- `user` - email пользователя
- `token` - access token для авторизации

#### Основные параметры фильтрации
- `category_id` - ID категории (можно несколько через запятую)
- `city` - название города, области или региона ⚠️ **ВАЖНО: используйте `city`, не `region`**
- `q` - поиск по заголовку
- `price1` - нижняя граница цены
- `price2` - верхняя граница цены
- `date1` - дата от (формат: "2024-01-01" или "2024-01-01 12:00:00")
- `date2` - дата до
- `source` - ID сайта-источника (1-avito, 3-yandex, 4-cian, 5-sob, 6-youla, 10-moyareklama, 11-domclick)

#### Параметры для недвижимости
- `nedvigimost_type` - ID типа недвижимости
- `metro` - станция метро или район
- `person_type` - тип автора (1-частное лицо, 2-агентство, 3-собственник)

#### Технические параметры
- `format` - формат ответа (json/xml, по умолчанию json)
- `limit` - ограничение количества (макс. 1000 платный / 50 тестовый)
- `startid` - получение объявлений с ID больше указанного
- `sort` - сортировка по времени (asc/desc, по умолчанию desc)
- `withcoords` - только объявления с координатами (1)
- `withphone` - включать объявления без телефонов (0)
- `phone_protected` - фильтр по защищенным номерам (0/1)

#### Пример запроса
```
https://ads-api.ru/main/api?user=email@example.com&token=YOUR_TOKEN&city=Москва&category_id=2&limit=10&format=json
```

### 2. Получение одного объявления (`/main/apigetone`)

**URL**: `https://ads-api.ru/main/apigetone`  
**Метод**: GET

#### Параметры
- `user` - email пользователя (обязательный)
- `token` - access token (обязательный)
- `id` - ID объявления (обязательный)
- `format` - формат ответа (json/xml)

### 3. Дополнительные параметры категории (`/main/apigetparams`)

**URL**: `https://ads-api.ru/main/apigetparams`  
**Метод**: GET

#### Параметры
- `user` - email пользователя (обязательный)
- `token` - access token (обязательный)
- `category_id` - ID категории (обязательный)
- `format` - формат ответа (json/xml)

### 4. Проверка актуальности (`/main/apigetcheckfeed`)

**URL**: `https://ads-api.ru/main/apigetcheckfeed`  
**Метод**: GET

Возвращает фид результатов проверки объявлений на актуальность.

### 5. Добавление в очередь парсинга (`/main/api-add-link-to-parse-queue`)

**URL**: `https://ads-api.ru/main/api-add-link-to-parse-queue`  
**Метод**: GET

Добавляет объявление в очередь на парсинг по ссылке.

## Категории объявлений

| ID | Название |
|----|----------|
| 1 | Транспорт |
| 2 | Недвижимость |
| 3 | Работа |
| 4 | Услуги |
| 5 | Личные вещи |
| 6 | Для дома и дачи |
| 7 | Бытовая электроника |
| 8 | Хобби и отдых |
| 9 | Животные |
| 10 | Для бизнеса |

## Типы недвижимости (для category_id=2)

| ID | Тип |
|----|-----|
| 1 | Квартиры |
| 2 | Комнаты |
| 3 | Дома, дачи, коттеджи |
| 4 | Земельные участки |
| 5 | Гаражи и машиноместа |
| 6 | Коммерческая недвижимость |
| 7 | Недвижимость за рубежом |

## Операторы сотовой связи

| Значение | Оператор |
|----------|----------|
| beeline | Билайн |
| megafon | МегаФон |
| mts | МТС |
| tele2 | Теле2 |
| motiv | Мотив |

## Структура ответа

### Успешный ответ
```json
{
  "code": 200,
  "data": [
    {
      "id": "123456",
      "title": "Заголовок объявления",
      "price": 1000000,
      "currency": "RUB",
      "description": "Описание объявления",
      "phone": "89001234567",
      "person_type": 1,
      "city": "Москва",
      "metro": "Сокольники",
      "address": "ул. Примерная, 1",
      "lat": 55.7558,
      "lng": 37.6173,
      "source": 1,
      "source_url": "https://avito.ru/...",
      "time": "2024-01-01 12:00:00",
      "category_id": 2,
      "nedvigimost_type": 1,
      "images": [
        "https://example.com/image1.jpg",
        "https://example.com/image2.jpg"
      ]
    }
  ]
}
```

### Ответ с ошибкой
```json
{
  "code": 400,
  "error": "В запросе передан один или несколько несуществующих параметров",
  "params_with_error": ["region"]
}
```

## Рекомендации по использованию

### Для недвижимости
1. Используйте `category_id=2` для недвижимости
2. Указывайте `nedvigimost_type=1` для квартир
3. **Обязательно используйте параметр `city` вместо `region`**
4. Для получения объявлений от частников добавляйте `withphone=0`

### Пагинация
Используйте параметр `startid` для получения новых объявлений:
```
1. Запрос: limit=1000
2. Получаем максимальный id из ответа: max_id
3. Следующий запрос: startid=max_id+1
```

### Фильтрация по времени
Время указывается в московском часовом поясе минус 30 минут:
```
date1=2024-01-01 00:00:00
date2=2024-01-01 23:59:59
```

## Ошибки и их решение

| Проблема | Решение |
|----------|---------|
| Код 400 с "несуществующий параметр region" | **Используйте параметр `city`** |
| Код 429 | Увеличьте паузу между запросами до 5+ секунд |
| Пустой ответ | Проверьте фильтры, возможно слишком строгие условия |
| Скрытые телефоны | Оформите платный доступ |

## Примеры запросов

### Квартиры в Москве
```
https://ads-api.ru/main/api?user=test@example.com&token=TOKEN&city=Москва&category_id=2&nedvigimost_type=1&limit=50
```

### Поиск по ключевому слову
```
https://ads-api.ru/main/api?user=test@example.com&token=TOKEN&q=студия&category_id=2&limit=20
```

### Объявления с координатами
```
https://ads-api.ru/main/api?user=test@example.com&token=TOKEN&city=Санкт-Петербург&withcoords=1&limit=100
```

### Только от частных лиц
```
https://ads-api.ru/main/api?user=test@example.com&token=TOKEN&person_type=1&category_id=2&limit=50
```

## Важные замечания для разработчиков

1. **Параметр `region` НЕ поддерживается** - используйте только `city`
2. **Обязательная пауза** - минимум 5 секунд между запросами
3. **Кодирование URL** - все параметры с пробелами должны быть закодированы
4. **Лимиты тестового доступа** - максимум 50 объявлений, скрытые телефоны и цены
5. **Фильтрация по категориям** - для недвижимости используйте `category_id=2`