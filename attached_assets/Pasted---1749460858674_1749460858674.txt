# üîê –ö–û–ú–ü–õ–ï–ö–°–ù–û–ï –£–õ–£–ß–®–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´ –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò –ò –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò

## üéØ –¶–ï–õ–¨
–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–∞–≥–∞, –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —É–ª—É—á—à–∏—Ç—å UX.

## üìã –ü–õ–ê–ù –ö–û–ú–ü–õ–ï–ö–°–ù–û–ì–û –£–õ–£–ß–®–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
```bash
echo "=== –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô ===" > registration_test_report.txt

# 1. –¢–µ—Å—Ç backend API endpoint —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
echo "### BACKEND API –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï ###" >> registration_test_report.txt
curl -X POST "http://localhost:5000/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "–¢–µ—Å—Ç–æ–≤—ã–π",
    "lastName": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", 
    "username": "testuser123",
    "email": "test@example.com",
    "password": "TestPassword123",
    "promoCode": "TEST30"
  }' \
  -w "\n–°—Ç–∞—Ç—É—Å: %{http_code}\n–í—Ä–µ–º—è: %{time_total}s\n" >> registration_test_report.txt

# 2. –¢–µ—Å—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è email
echo "### –¢–ï–°–¢ –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø EMAIL ###" >> registration_test_report.txt
curl -X POST "http://localhost:5000/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "–î—Ä—É–≥–æ–π",
    "lastName": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
    "username": "testuser456", 
    "email": "test@example.com",
    "password": "TestPassword456"
  }' \
  -w "\n–°—Ç–∞—Ç—É—Å: %{http_code}\n" >> registration_test_report.txt

# 3. –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª—è
echo "### –¢–ï–°–¢ –í–ê–õ–ò–î–ê–¶–ò–ò –ü–ê–†–û–õ–Ø ###" >> registration_test_report.txt
curl -X POST "http://localhost:5000/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "–°–ª–∞–±—ã–π",
    "lastName": "–ü–∞—Ä–æ–ª—å",
    "username": "weakpass",
    "email": "weak@example.com", 
    "password": "123"
  }' \
  -w "\n–°—Ç–∞—Ç—É—Å: %{http_code}\n" >> registration_test_report.txt

# 4. –¢–µ—Å—Ç –≤—Ö–æ–¥–∞ —Å –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
echo "### –¢–ï–°–¢ –í–•–û–î–ê ###" >> registration_test_report.txt
curl -X POST "http://localhost:5000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "TestPassword123"
  }' \
  -w "\n–°—Ç–∞—Ç—É—Å: %{http_code}\n" >> registration_test_report.txt

cat registration_test_report.txt
```

### –≠—Ç–∞–ø 2: –£–ª—É—á—à–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ frontend
```javascript
// –í client/src/pages/Login.tsx –¥–æ–±–∞–≤–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é:

// 1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–æ–ª—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
const [passwordStrength, setPasswordStrength] = useState({
  score: 0,
  feedback: '',
  color: 'red'
});

const validatePassword = (password) => {
  let score = 0;
  let feedback = [];
  
  if (password.length >= 8) score++;
  else feedback.push('–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤');
  
  if (/[A-Z]/.test(password)) score++;
  else feedback.push('–æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞');
  
  if (/[a-z]/.test(password)) score++;
  else feedback.push('–æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞');
  
  if (/[0-9]/.test(password)) score++;
  else feedback.push('–æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞');
  
  if (/[^A-Za-z0-9]/.test(password)) score++;
  else feedback.push('–æ–¥–∏–Ω —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª');
  
  const colors = ['red', 'orange', 'yellow', 'lightgreen', 'green'];
  const messages = ['–û—á–µ–Ω—å —Å–ª–∞–±—ã–π', '–°–ª–∞–±—ã–π', '–°—Ä–µ–¥–Ω–∏–π', '–•–æ—Ä–æ—à–∏–π', '–û—Ç–ª–∏—á–Ω—ã–π'];
  
  return {
    score,
    feedback: feedback.length ? `–ù—É–∂–Ω–æ: ${feedback.join(', ')}` : messages[score - 1],
    color: colors[score]
  };
};

// 2. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è –≤ JSX
<div className="password-strength">
  <div 
    className="strength-bar" 
    style={{ 
      width: `${(passwordStrength.score / 5) * 100}%`,
      backgroundColor: passwordStrength.color,
      height: '4px',
      transition: 'all 0.3s'
    }}
  />
  <small style={{ color: passwordStrength.color }}>
    {passwordStrength.feedback}
  </small>
</div>

// 3. –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é email
const validateEmail = (email) => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const isValid = emailRegex.test(email);
  
  return {
    isValid,
    message: isValid ? '' : '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å'
  };
};
```

### –≠—Ç–∞–ø 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ rate limiting –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```javascript
// –í server/routes.ts –¥–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

import rateLimit from 'express-rate-limit';

// Rate limiting –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∂–µ —á–µ–º –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
const registrationLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 3, // –º–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞ 15 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP
  message: {
    error: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç.',
    retryAfter: 15 * 60
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ —Ä–æ—É—Ç—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
app.post('/api/auth/register', registrationLimiter, async (req, res) => {
  // —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
});

// Rate limiting –¥–ª—è –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç  
  max: 5, // –º–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –∑–∞ 15 –º–∏–Ω—É—Ç
  message: {
    error: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç.',
    retryAfter: 15 * 60
  }
});

app.post('/api/auth/login', loginLimiter, async (req, res) => {
  // —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –≤—Ö–æ–¥–∞
});
```

### –≠—Ç–∞–ø 4: –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ UX
```javascript
// –í client/src/pages/Login.tsx —É–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:

const [errors, setErrors] = useState({
  firstName: '',
  lastName: '',
  username: '',
  email: '',
  password: '',
  general: ''
});

const [isSubmitting, setIsSubmitting] = useState(false);

const handleRegistration = async (e) => {
  e.preventDefault();
  setIsSubmitting(true);
  setErrors({});
  
  try {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ frontend –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    const newErrors = {};
    
    if (!firstName.trim()) newErrors.firstName = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
    if (!lastName.trim()) newErrors.lastName = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
    if (!username.trim()) newErrors.username = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
    
    const emailValidation = validateEmail(email);
    if (!emailValidation.isValid) newErrors.email = emailValidation.message;
    
    const passwordValidation = validatePassword(password);
    if (passwordValidation.score < 3) {
      newErrors.password = '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã–π. ' + passwordValidation.feedback;
    }
    
    if (Object.keys(newErrors).length > 0) {
      setErrors(newErrors);
      setIsSubmitting(false);
      return;
    }
    
    const response = await fetch('/api/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        firstName,
        lastName, 
        username,
        email,
        password,
        promoCode
      })
    });
    
    const data = await response.json();
    
    if (!response.ok) {
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
      if (response.status === 409) {
        if (data.error.includes('email')) {
          setErrors({ email: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' });
        } else if (data.error.includes('username')) {
          setErrors({ username: '–≠—Ç–æ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ' });
        } else {
          setErrors({ general: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' });
        }
      } else if (response.status === 429) {
        setErrors({ general: data.error || '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.' });
      } else if (response.status === 422) {
        // –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        if (data.errors) {
          const serverErrors = {};
          data.errors.forEach(err => {
            serverErrors[err.field] = err.message;
          });
          setErrors(serverErrors);
        } else {
          setErrors({ general: data.error || '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö' });
        }
      } else {
        setErrors({ general: data.error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏' });
      }
      return;
    }
    
    // –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    setUser(data.user);
    setIsAuthenticated(true);
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
    showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 'success');
    
  } catch (error) {
    console.error('Registration error:', error);
    setErrors({ 
      general: '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.' 
    });
  } finally {
    setIsSubmitting(false);
  }
};

// –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ –≤ JSX
<button 
  type="submit" 
  disabled={isSubmitting}
  className={`registration-button ${isSubmitting ? 'loading' : ''}`}
>
  {isSubmitting ? (
    <>
      <span className="spinner"></span>
      –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è...
    </>
  ) : (
    '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è'
  )}
</button>

// –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ
{errors.firstName && <span className="error-text">{errors.firstName}</span>}
{errors.email && <span className="error-text">{errors.email}</span>}
{errors.general && <div className="error-banner">{errors.general}</div>}
```

### –≠—Ç–∞–ø 5: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```javascript
// –í server/routes.ts –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:

import nodemailer from 'nodemailer';
import crypto from 'crypto';

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
const sendVerificationEmail = async (email, token) => {
  const transporter = nodemailer.createTransporter({
    host: process.env.SMTP_HOST,
    port: process.env.SMTP_PORT,
    secure: false,
    auth: {
      user: process.env.SMTP_USER,
      pass: process.env.SMTP_PASS
    }
  });
  
  const verificationUrl = `${process.env.FRONTEND_URL}/verify-email?token=${token}`;
  
  await transporter.sendMail({
    from: process.env.SMTP_USER,
    to: email,
    subject: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ sreda.market',
    html: `
      <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ sreda.market!</h2>
      <p>–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ:</p>
      <a href="${verificationUrl}">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email</a>
      <p>–°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.</p>
    `
  });
};

// –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
app.post('/api/auth/register', registrationLimiter, async (req, res) => {
  try {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
    const verificationToken = crypto.randomBytes(32).toString('hex');
    const verificationExpires = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 —á–∞—Å–∞
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–æ–∫–µ–Ω–æ–º
    const newUser = await createUser({
      ...userData,
      verificationToken,
      verificationExpires,
      isEmailVerified: false
    });
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    await sendVerificationEmail(email, verificationToken);
    
    res.status(201).json({
      message: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.',
      user: { id: newUser.id, email: newUser.email },
      emailSent: true
    });
    
  } catch (error) {
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  }
});

// –î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
app.get('/api/auth/verify-email', async (req, res) => {
  try {
    const { token } = req.query;
    
    if (!token) {
      return res.status(400).json({ error: '–¢–æ–∫–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω' });
    }
    
    const user = await findUserByVerificationToken(token);
    
    if (!user) {
      return res.status(400).json({ error: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω' });
    }
    
    if (user.verificationExpires < new Date()) {
      return res.status(400).json({ error: '–¢–æ–∫–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω' });
    }
    
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
    await updateUser(user.id, {
      isEmailVerified: true,
      verificationToken: null,
      verificationExpires: null
    });
    
    res.json({ message: 'Email —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω' });
    
  } catch (error) {
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ email' });
  }
});
```

### –≠—Ç–∞–ø 6: –°–æ–∑–¥–∞–Ω–∏–µ comprehensive —Ç–µ—Å—Ç–æ–≤
```javascript
// –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª tests/auth.test.js –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

const request = require('supertest');
const app = require('../server/index');

describe('Authentication', () => {
  describe('Registration', () => {
    it('should register a new user successfully', async () => {
      const response = await request(app)
        .post('/api/auth/register')
        .send({
          firstName: 'Test',
          lastName: 'User',
          username: 'testuser',
          email: 'test@example.com',
          password: 'TestPassword123'
        });
        
      expect(response.status).toBe(201);
      expect(response.body.user).toHaveProperty('id');
      expect(response.body.user.email).toBe('test@example.com');
    });
    
    it('should reject duplicate email registration', async () => {
      // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      await request(app)
        .post('/api/auth/register')
        .send({
          firstName: 'First',
          lastName: 'User',
          username: 'firstuser',
          email: 'duplicate@example.com',
          password: 'TestPassword123'
        });
        
      // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Ç–µ–º –∂–µ email
      const response = await request(app)
        .post('/api/auth/register')
        .send({
          firstName: 'Second',
          lastName: 'User', 
          username: 'seconduser',
          email: 'duplicate@example.com',
          password: 'TestPassword456'
        });
        
      expect(response.status).toBe(409);
      expect(response.body.error).toContain('email');
    });
    
    it('should reject weak passwords', async () => {
      const response = await request(app)
        .post('/api/auth/register')
        .send({
          firstName: 'Weak',
          lastName: 'Password',
          username: 'weakpass',
          email: 'weak@example.com',
          password: '123'
        });
        
      expect(response.status).toBe(422);
      expect(response.body.error).toContain('password');
    });
  });
});

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
npm test -- auth.test.js
```

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–®–ù–û–ì–û –£–õ–£–ß–®–ï–ù–ò–Ø

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- [ ] –í—Å–µ backend API —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] Frontend –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏  
- [ ] Rate limiting –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∞–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- [ ] –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
- [ ] Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)
- [ ] Unit —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
```bash
# –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ registration flow:
echo "=== –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò ===" 

# 1. –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
echo "–¢–µ—Å—Ç 1: –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
curl -X POST "http://localhost:5000/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{"firstName":"Final","lastName":"Test","username":"finaltest","email":"final@test.com","password":"FinalTest123"}'

# 2. –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
echo "–¢–µ—Å—Ç 2: –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥"  
curl -X POST "http://localhost:5000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"final@test.com","password":"FinalTest123"}'

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
echo "–¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"
curl -X GET "http://localhost:5000/api/users/profile" \
  -H "Cookie: session_cookie_from_login"

echo "–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ü–û–õ–ù–û–°–¢–¨–Æ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–ê ‚úÖ"
```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –±—É–¥–µ—Ç:
- **–ù–∞–¥–µ–∂–Ω–æ–π** - —Å proper –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ rate limiting
- **User-friendly** - —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–π** - —Å strong password requirements
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ–π** - —Å comprehensive test coverage
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π** - —Å email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –≥–æ—Ç–æ–≤–æ–π –∫ production

**üöÄ –°–ò–°–¢–ï–ú–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò –ì–û–¢–û–í–ê –ö PRODUCTION –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!**